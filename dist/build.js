!function(t){var e={};function o(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=e,o.d=function(t,e,s){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(s,i,function(e){return t[e]}.bind(null,i));return s},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){"use strict";o.r(e);Vue.component("goods-item",{props:["good","cart"],computed:{goodsIdInCart(t){let e=[];return this.cart.forEach(t=>{e.push(t.id)}),e}},methods:{add(t){this.goodsIdInCart.includes(this.good.id)||this.$emit("add",t)}},template:'\n\t\t<div class="goods-item">\n\t\t\t<img :src="good.img" width="180" height="180">\n\t\t\t<h3>{{ good.title }}</h3>\n\t\t\t<p>Цена: {{ good.price }} $</p>\n\t\t\t<button class="btn item-button" :data-id="good.id" :class="{inCart: goodsIdInCart.includes(good.id)}" @click.prevent="add">{{ goodsIdInCart.includes(good.id) ? \'Добавлено\' : \'Добавить в корзину\' }}</button>\n\t\t</div>\n\t'});Vue.component("goods-list",{props:["goods","cart"],computed:{isGoodsNotEmpty(){return this.goods.length>0}},methods:{add(t){this.$emit("add",t)}},template:'\n\t\t<div class="goods-list" v-if="isGoodsNotEmpty">\n\t\t\t<goods-item v-for="good in goods" :good="good" :cart="cart" :key="good.id" @add="add"></goods-item>\n\t\t</div>\t\t\n\t\t<div class="no-items" v-else>\n\t\t\tНет подходящих товаров\n\t\t</div>\n\t'}),Vue.component("search",{data:()=>({searchLine:""}),props:["goods"],computed:{filteredGoods(){const t=new RegExp(this.searchLine,"i");return this.goods.filter(e=>t.test(e.title))}},methods:{cleanSearch(){this.searchLine="",this.$emit("filter_send",this.filteredGoods)},filter_send(){this.$emit("filter_send",this.filteredGoods)}},template:'\n\t\t<form class="goods-search-form" @submit.prevent>\n\t\t\t<input type="text" class="goods-search" ref="searchInput" v-model.trim="searchLine" @keyup.prevent="filter_send()"></input>\n\t\t\t<button class="clean-search" @click="cleanSearch">X</button>\n\t\t</form>\n\t'}),Vue.component("cart",{props:["goods","visible","cart_goods"],computed:{isCartNotEmpty(){return this.cart_goods.length>0},totalPrice(){return this.cart_goods.reduce((t,e)=>e.price?t+e.price*e.qty:t,0)}},methods:{identifyItem(t){return goodId=t.target.getAttribute("data-id"),good=this.goods.find(t=>t.id===goodId),good},plusOne(t){this.$emit("plus_one_item",t)},minusOne(t){goodId=t.target.getAttribute("data-id"),good=this.cart_goods.find(t=>t.id===goodId),good.qty>1?this.$emit("minus_one_item",t):this.cart_remove_good(t)},cart_remove_good(t){this.$emit("cart_remove_good",t)},cart_close(){this.$emit("cart_close")}},template:'\n\t\t<transition name="fade">\n\t\t\t<div class="cart-list" v-if="visible">\n\t\t\t\t<button class="close_cart" @click.prevent="cart_close">X</button>\n\t\t\t\t<div class="cart-item" v-for="good in cart_goods">\n\t\t\t\t\t<img :src="good.img" width="90" height="90">\n\t\t\t\t\t<div class="cartColumn goodDescr">\n\t\t\t\t\t\t<p><b>Наименование:</b></p>\n\t\t\t\t\t\t<p><b>{{ good.title }}</b></p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="cartColumn goodPrice">\t\t\t\t\t\n\t\t\t\t\t\t<p><b>Цена:</b></p>\n\t\t\t\t\t\t<p>{{ good.price }} $</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="cartColumn goodQty">\t\t\t\t\t\n\t\t\t\t\t\t<p><b>Кол-во:</b></p>\n\t\t\t\t\t\t<p>{{ good.qty }} шт.</p>\n\t\t\t\t\t\t<button class="qtyBtn plusBtn" :data-id="good.id" @click.prevent="plusOne">+</button>\t\t\t\t\t\n\t\t\t\t\t\t<button class="qtyBtn minusBtn" :data-id="good.id" @click.prevent="minusOne">-</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="cartColumn goodSum">\t\t\t\t\t\n\t\t\t\t\t\t<p><b>Сумма:</b></p>\n\t\t\t\t\t\t<p><b>{{ good.sum = good.price * good.qty}} $</b></p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button class="item-button btn" :data-id="good.id" @click.prevent="cart_remove_good">Удалить из корзины</button>\n\t\t\t\t</div>\n\t\t\t\t<div class="cartSum" v-if="isCartNotEmpty"><b>Итого: {{ totalPrice }} $</b></div>\n\t\t\t\t<div class="no-items cart-no-items" v-else>В корзине нет товаров</div>\n\t\t\t</div>\n\t\t</transition>\n\t'}),Vue.component("error",{template:'\n\t\t\t<div class="error">\t\t\t\n\t\t\t\tНет связи с сервером товаров\n\t\t\t</div>\n\t'});new Vue({el:"#app",data:{goods:[],filteredGoods:[],cartGoods:[],isVisibleCart:!1,isError:!1},computed:{cartCount(){return this.cartGoods.length}},created(){this.makeGETRequest("/cartData").then(t=>{this.cartGoods=t}).catch(t=>{this.isError=!this.isError,console.error(t)})},mounted(){this.makeGETRequest("/catalogData").then(t=>{t.forEach(t=>{t.qty=0,t.sum=0}),this.goods=t,this.filteredGoods=t}).catch(t=>{this.isError=!this.isError,console.error(t)})},methods:{makeGETRequest:t=>new Promise((e,o)=>{const s=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");s.onreadystatechange=function(){if(4===s.readyState)if(200!==s.status)o(s.status);else{const t=JSON.parse(s.responseText);e(t)}},s.onerror=t=>o(t),s.open("GET",t),s.send()}),makePOSTRequest:(t,e)=>new Promise((o,s)=>{const i=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");i.onreadystatechange=function(){if(4===i.readyState)if(200!==i.status)s(i.status);else{const t=JSON.parse(i.responseText);o(t)}},i.onerror=t=>s(t),i.open("POST",t),i.setRequestHeader("Content-type","application/json; charset=UTF-8"),i.send(JSON.stringify(e))}),makeDELETERequest:(t,e)=>new Promise((o,s)=>{const i=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");i.onreadystatechange=function(){if(4===i.readyState)if(200!==i.status)s(i.status);else{const t=JSON.parse(i.responseText);o(t)}},i.onerror=t=>s(t),i.open("DELETE",t),i.setRequestHeader("Content-type","application/json; charset=UTF-8"),i.send(JSON.stringify(e))}),async addNewItem(t){goodId=t.target.getAttribute("data-id"),good=this.goods.find(t=>t.id===goodId);try{this.isAlreadyAdd(good)||(good.qty=1,this.cartGoods=await this.makePOSTRequest("/addToCart",good),this.addStat("Добавлен товар",good.title))}catch(t){throw new Error(t)}},async removeItem(t){good=this.identifyItem(t);try{this.cartGoods=await this.makeDELETERequest("/removeFromCart",good),this.addStat("Удалён товар",good.title)}catch(t){throw new Error(t)}},async minusOneItem(t){good=this.identifyItem(t);try{this.cartGoods=await this.makePOSTRequest("/minusOneItem",good),this.addStat("Удалена 1шт",good.title)}catch(t){throw new Error(t)}},async plusOneItem(t){good=this.identifyItem(t);try{this.cartGoods=await this.makePOSTRequest("/plusOneItem",good),this.addStat("Добавлена 1шт",good.title)}catch(t){throw new Error(t)}},addStat(t,e){let o={"действие":t,"описание":e,"время":Date()};this.makePOSTRequest("/addStat",o)},identifyItem(t){return goodId=t.target.getAttribute("data-id"),good=this.goods.find(t=>t.id===goodId),good},isAlreadyAdd(t){return this.cartGoods.includes(t)},toggleCartVisibility(){this.isVisibleCart=!this.isVisibleCart,this.$refs.mainHeader.classList.toggle("blur"),this.$refs.mainContent.classList.toggle("blur")},updateGoods(t){this.filteredGoods=t}}})}]);